# 编译原理笔记10：语言与文法、正规式转CFG、正规式和CFG的关系

对语言进行形式化描述的规则叫文法。

词法规则、语法规则都以形式化的方法对语言进行描述，这样的规则就叫文法。在使用 lex 的时候，我们就可以使用文法来简单地定义和修改语言。

前几篇笔记中我们比较细致地研究了正规式，当时我们用正规式来描述词法规则，然后根据正规式构造可以识别由该正规式表示的语言的自动机。

但其实，**CFG 也是可以描述词法的**。*（但为什么不这么做呢？）***正规式和 CFG 甚至是等价的！**

## 正规式，和 CFG

**正规式所描述的语言结构都可以用 CFG 描述，反之不一定。**

**正规式和 CFG 是有关系的！NFA 是可以转化成 CFG 的！！一个 NFA 的状态和状态转移关系就对应一个产生式！！**~~惊不惊喜？意不意外？？？~~至于为啥可以咱们暂且不论，先从这里往下看，后面时机成熟，自会解释。

### 正规式到 CFG 的转换：

1. 构造正规式的 NFA；

2. 若 0 为初态，则 A0 为开始符号；

3. 对于 move(i, a) = j，引入产生式 Ai → aAj；

   【从 i 状态经过标记为 a 的边转移到 j 状态。对于这样的状态转移关系，我们可以为其生成对应的产生式 Ai → aAj 】

   **NFA 中的每个边，即每个状态转移都会生成一个对应的产生式。**我们在这里引入 Ai → aAj（这里的 a 是指经过的边），这样一来，我们就用这种方法将 NFA 中的状态以及状态转移关系变成了 CFG 中的产生式。

4. 对于 move(i, ε) = j，引入产生式 Ai → Aj；

   为空转移生成与之对应的产生式。

5. 若 i 是终态，则引入产生式 Ai → ε（终态，对应的是空产生式）。

NFA 中有状态和状态间的转移，我们就可以把这些变成一个 CFG

【例】以正规式 r = ( a|b )*abb 的 NFA 构造 CFG。

![](./img/10_1.png)

*如果没有最后的 ε，那么无论怎么推导，在推导的下一步总会引入一个新的非终结符，永远得不到一个我们想要的句子。*

通过这种方式转化出来的 CFG 也是一种“正规文法”（后续会讲到）

另外，我们也可以使用经验（脑补）的方法来将正规式转化成 CFG。对于上面的正规式 r，我们不难（？）写出：

```
A → HT
H → ε | Ha | Hb
T → abb
```

过程：

1. 通过观察，我们发现正规式 (a|b)*abb 是可以分为明显的两部分的，即a或b的星闭包连接上abb。第一部分就是星闭包，第二部分就是abb。因此，我们在构造 CFG 的时候，也就可以一上来就把开始符号拆成两部分，即上面第一行的 H 和 T
2. 我们用前面的非终结符 H 来生成正规式中前半部分的星闭包。a或b的星闭包，就是由a或b构成的长度>=0的一个ab串，于是我们就可以通过 H 本身不限次引入 a、b 来构造星闭包，具体就是第二行的产生式。产生式 H->ε 的作用有二，一是为了满足只有空串的情况，因为星闭包可以为空；二是用来结束 H 的产生式，只有有了 ε，我们才能够结束对 H 的构造，否则这个推导会一路无限递归下去。。。
3. T 就是给 abb 准备的

万一，如果 H 是正闭包而不是星闭包，那么就可以改成：H→a|b|Ha|Hb

### 正规式和 CFG 的关系

我们都知道：如果 NFA 能够接受一个串，那就说明在这个 NFA 内部一定存在一条从初态到终态的路径，路径上的链接就是这个串本身。

而，从上面的转化规则和例子，我们可以确定：这样的一个串一定对应CFG里面的一个推导。

也就是说，NFA 中的一个路径一定对应着 CFG 中的一个推导。反过来讲，CFG 中任意一个推导也都对应着 NFA 中的一个路径。

因此，**正规式与 CFG 之间是等价的！！**

任意一个正规式所描述的语言，都可用 CFG 来描述。也就是说对任意一个正规式，我们都可以为他构造出来其相应的、和它描述的语言相同的集合的 CFG。

但反过来，就不一定了——并不是所有用 CFG 描述的语言都可以用正规式来描述



好的，我已经很震撼了：既然凡是正规式能描述的，都能用CFG描述，反之则不行。这就说明 CFG 的语言描述能力更强。

可，为什么还用正规式，而非 CFG 来描述词法呢？？？

### 为毛不用 CFG 描述词法规则

原因很简洁：对人好，对机器也好。

**对人好**：正规式更直观简单，人容易理解。而正规式描述词法恰巧已经够用了（词法无非标识符、关键字、字面量之类，这些都是线性结构，使用正规式就能充分描述）；

**对机器好**：DFA 构造起来比用于 CFG 分析的下推自动机简单，效率更高。且使用两种不同方式来表示词法和语法，便于对两者进行区分，便于编译器前端的模块划分。

### 贯穿词法、语法分析始终的思想

1. 语言的描述和识别，是表示一个语言的两个侧面，二者缺一不可；
2. 一般而言，正规式适用于描述线性结构（标识符、关键字、注释等）；
3. CFG 适用于描述具有嵌套（层次）性质的非线性结构，比如不同结构的句子 if-then-else、while-do 等；
4. 用正规式和 CFG 描述的语言，对应的识别方法（自动机）不同。