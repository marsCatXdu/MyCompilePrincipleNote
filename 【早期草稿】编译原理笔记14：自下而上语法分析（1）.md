# 编译原理笔记14：自下而上语法分析（1）短语、句柄、规约的概念

## 基本方法

> 从句子 ω 开始，从左到右扫描 ω，反复用产生式的左部替换产生式的右部、谋求对 ω 的匹配，最终得到文法的开始符号（或，发现错误）（也就是从下往上搞出个树，最后推到根也就是开始符号了）

在分析的过程中，每一步都总是尝试在句型中寻找一个能够被替换为产生式左部的子串。就这样一步步向上去替换，最终变成一个开始符号。

而，由于我们对记号流的扫描是从左到右的，故我们【尝试寻找句型中能够被替换为产生式左部的子串，并不断进行替换】的过程也是从左到右的。这样从记号到开始符号一步进行自下而上分析的逆过程其实就是一个最右推导！

推导的逆过程，就叫做【规约】。最右推导的逆过程，就是最左规约。

![](./img/2020-07-26_03-59-14.png)

## 短语、句柄，规范规约，剪句柄

最右推导叫做【规范推导】，因此作为其逆过程的最左规约，也就是【规范规约】了

### 短语、直接短语和句柄

> 设 αβδ 是文法 G 的一个句型，若存在 S =*> αAδ ， A =+> β，则称 β 是句型 αβδ 相对于 A 的【短语】。若 A→β ，则称 β 是句型 αβδ 相对于产生式 A→β 的【直接短语】。一个句型的最左直接短语被称为【句柄】。
>
> 句型，是一个完整的结构，短语则是句型中针对某非终结符的局部。因此，开始符号 S 是句型而不是短语。
>
> 短语形成的要素：
>
> - S 可推导出 A，即 S=*> αAδ ；
> - 从 A 开始经过至少一次推导推出 β，即 A=+> β。

**我个人认为（俺寻思）**：进行规约的一大关键点，是怎么在一堆本质上是字符串的符号流中，试图搞明白 “这到底哪几个连在一块的字符算一个符号啊？这到底几个符号连起来能和哪个产生式的右部匹配上啊？” 的问题。而这里的【短语】、【直接短语】、【句柄】概念，其实就是**描述产生式右部的组合及边界**的方案——回想自然语言中的 “短语”，自然语言中的短语是指由至少两个单词构成的、有序组合起来共同表达某一个含义的有序单词序列——只有特定的单词以特定的顺序组成序列才能被称为**一个**短语。那么语法分析中的短语也是一样的：语法分析中的短语是指由至少数个终结符或(和)非终结符构成的、有序组合起来的符号序列，这个序列就是某个产生式的右部，也就可以在规约时被规约为一个产生式的左部。

反映在上面定义的例子中，就是：

- β 是句型 αβδ 相对于 A 的【短语】，那么 αβδ 就可以经过至少一步规约后规约为 αAδ 。而 αAδ 则能够在经过零或多步规约后，最终规约为开始符号 S；
-  β 是句型 αβδ 相对于产生式 A→β 的【直接短语】，那么 αβδ 就可以在经过一步规约后成为  αAδ ；

![](./img/2020-07-26_14-13-29.png)

短语，不一定是包含终结符的序列，也可以是单个的非终结符。在整个规约的过程中，句柄会不断变化：毕竟，根据定义，短语只是【从开始符号 S 可以导出（经过零或多步推导，不导也行。。）的非终结符 A 在经过至少一步推导后得出的句型】。那么在下面这个例子中，从开始符号 S 一定是可以经过推导得到非终结符 T2 的，T2 也能在经过一步推导后展开为 F1。那么，F1 就是 T2 的短语（而且是直接短语，而且是最左直接短语，那么这里的 F1 就是 T2 的句柄了）

![](./img/2020-07-26_14-14-33.png)

- 短语：以非终结符为根子树中所有从左到右的叶子
- 直接短语：只有父子关系的树中所有从左到右排列的叶子（树高为2）
- 句柄：最左边父子关系树中所有从左到右排列的叶子（句柄是唯一的）



### 规范规约（最左规约）

> 若 α 是文法 G 的句子且满足下列条件，则称序列 αn, αn-1, ..., α0 是一个最左规约：
>
> 1. αn = α
> 2. α0 = S（ G 的开始符号）
> 3. 对任何 i(0 < i <= n)，αi-1 是将 αi 中的句柄替换为相应产生式左部的非终结符得到的。

#### 例：

文法：(1)S→aABe    (2)A→b    (3)A→Abc   (4)B→d，对句子 abbcde 的最左规约是：

abbcde <= aAbcde <= aAde <= aABe <= S

上面这个过程，从左往右看是最左规约（称为规范规约），从右往左看就是最右推导了

其实，上面的过程是非常简略的，这里有一些关键的细节需要到后面才能逐渐搞明白。比如，第二步到第三步规约的时候，为什么没有把 aAbcde 规约为 aAAcde？（这是因为如果这样规约就无法继续规约下去了）解决这个问题其实就要用到我们前面博客中说过的 FIRST、FOLLOW 集合以及下推栈。



### 剪句柄

剪句柄，为向上规约提供了另一个理解的思路，非必要，先暂略

